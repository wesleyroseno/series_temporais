---
lang: pt-BR
title: "<center>Séries Temporais</center>"
subtitle: "<center>Temperaturas Médias Mensais</center>"
author:
  - name: "Adrielly Rocha de Sousa Ferreira"
  - name: "Wesley Roseno Saraiva"
date: 06-27-2025
bibliography:
  - "referencias/referencias.bib"
format:
  html:
    toc: true
    toc-location: left
    toc_float: yes
    code-fold: true
    self_contained: true
    self-contained-math: true
    embed-resources: true
    theme: darkly
    number-sections: true
---

```{r setup, message = FALSE, warning = FALSE}
# Configurações globais para os blocos de código
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.align = 'center')

# Vetor com os nomes dos pacotes que você deseja usar
pacotes <- c(
  "tidyverse",  # inclui ggplot2, dplyr, tidyr, magrittr (%>%), etc.
  "lubridate",
  "forecast",
  "tseries",
  "readxl",
  "leaflet",
  "geosphere"
)

# Loop para verificar, instalar (se necessário) e carregar cada pacote
for (p in pacotes) {
  if (!requireNamespace(p, quietly = TRUE)) {
    install.packages(p)
  }
  library(p, character.only = TRUE)
}
```

# Introdução e Análise Exploratória dos Dados

## Contexto Geográfico e Climatológico

Este relatório foca-se em duas localidades costeiras de São Paulo: Cananéia e Ubatuba. Cananéia está no Litoral Sul, numa região de estuário, enquanto Ubatuba, no Litoral Norte, tem maior exposição ao Atlântico. A análise comparativa permite investigar como estas diferenças geográficas se traduzem em padrões de temperatura distintos.

**Figura [-@fig-grafico]: Distancia entre Cananéia e Ubatuba.**

```{r}
#| label: fig-grafico
#| fig-cap: ""
# Definição das coordenadas
coords <- data.frame(
  cidade = c("Cananéia", "Ubatuba"),
  lat    = c(-25.012621, -23.4336713),
  lon    = c(-47.9338687, -45.0838529)
)

# Calcula distância geodésica em metros e converte para quilômetros
dist_m <- distGeo(c(coords$lon[1], coords$lat[1]), c(coords$lon[2], coords$lat[2]))
dist_km <- round(dist_m / 1000, 2)

# Calcula ponto médio para posicionar o rótulo
mid_lat <- mean(coords$lat)
mid_lon <- mean(coords$lon)

# Cria o mapa
leaflet(data = coords) %>%
  addTiles() %>%  # camada base OpenStreetMap
  addCircleMarkers(
    lng = ~lon, lat = ~lat,
    label = ~cidade,
    radius = 8,
    color = "navy",
    fillColor = "skyblue",
    fillOpacity = 0.7,
    stroke = TRUE, weight = 1
  ) %>%
  # Adiciona linha conectando as cidades
  addPolylines(
    lng = coords$lon, lat = coords$lat,
    color = "red",
    weight = 2,
    opacity = 0.8
  ) %>%
  # Adiciona rótulo com a distância no ponto médio
  addLabelOnlyMarkers(
    lng = mid_lon, lat = mid_lat,
    label = paste0(dist_km, " km"),
    labelOptions = labelOptions(
      noHide = TRUE,
      direction = "center",
      textOnly = TRUE,
      style = list(
        "color" = "red",
        "font-weight" = "bold",
        "background" = "white",
        "padding" = "4px"
      )
    )
  ) %>%
  addControl(
    html = "<strong>Cidades Litorâneas de SP</strong>",
    position = "topright"
  )
```

## O Conjunto de Dados: Estrutura

Os dados são de temperaturas médias mensais (°C) de janeiro de 1976 a dezembro de 1985. São duas séries temporais, cada uma com 120 observações.


```{r dados}
df_raw <- readxl::read_excel(
  path = "dados/temperatura.xls",
  sheet = "Plan1",
  col_names = TRUE
)

df_raw$Ano <- seq(as.Date("1976-01-01"), as.Date("1985-12-01"), by="month")

# Converter para objetos de série temporal (ts)
cananeia_ts <- ts(df_raw$Cananeia, start = c(1976, 1), frequency = 12)
ubatuba_ts <- ts(df_raw$Ubatuba, start = c(1976, 1), frequency = 12)
```

## Análise Visual e Descritiva Preliminar

Ambas as séries exibem um padrão cíclico anual, indicando uma componente sazonal. Visualmente, Ubatuba parece ser consistentemente mais quente, exceto no ano de 1983.

**Figura [-@fig-serie]: Séries temporais de temperatura para Cananéia e Ubatuba.**

```{r}
#| label: fig-serie
#| fig-cap: ""
# Plotando as séries temporais com ggplot2
df_raw %>%
  pivot_longer(cols = c(Cananeia, Ubatuba), names_to = "Localidade", values_to = "Temperatura") %>%
  ggplot(aes(x = Ano, y = Temperatura, color = Localidade)) +
  geom_line(linewidth = 1) +
  labs(
    title = "Temperaturas Médias Mensais (1976-1985)",
    x = "Ano",
    y = "Temperatura (°C)"
  ) +
  scale_color_manual(values = c("Cananeia" = "royalblue", "Ubatuba" = "darkorange")) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

**Tabela [-@tbl-descritiva]: Estatísticas Descritivas das Temperaturas Médias Mensais (°C)**


```{r}
#| label: tbl-descritiva
#| tbl-cap: ""
# Cálculo das estatísticas básicas
resumo_Cananeia <- summary(df_raw$Cananeia)
resumo_Ubatuba <- summary(df_raw$Ubatuba)
df_resumo <- data.frame(
  Estatística = c("Valor mínimo", "1º Quartil", "Mediana", "Média", "3º Quartil", "Valor Máximo"),
  Cananeia = round(as.numeric(resumo_Cananeia), 1),
  Ubatuba = round(as.numeric(resumo_Ubatuba), 1)
)

# Cálculo do desvio padrão
sd_Cananeia <- round(sd(df_raw$Cananeia, na.rm = TRUE), 1)
sd_Ubatuba  <- round(sd(df_raw$Ubatuba,  na.rm = TRUE), 1)

# Criar data frame para desvio padrão e adicionar ao resumo
df_sd <- data.frame(
  Estatística = "Desvio padrão",
  Cananeia    = sd_Cananeia,
  Ubatuba     = sd_Ubatuba
)

df_resumo <- rbind(df_resumo, df_sd)

# Exibir tabela final
knitr::kable(df_resumo,
             row.names = FALSE
             )
```

A Tabela [-@tbl-descritiva] quantifica que Ubatuba é, em média, 0,9°C mais quente, sendo maior também  a sua temperatura mediana. E apesar de Ubatuba ter a menor e maior temperatura, Cananéia apresenta um desvio padrão ligeiramente maior, indicando maior variabilidade em torno da sua média.

# Decomposição Estrutural das Séries Temporais

## Metodologia de Decomposição

Usamos um modelo de decomposição aditivo ($Y_t = T_t + S_t + I_t$), pois a amplitude das flutuações sazonais parece constante ao longo do tempo.

## Análise do Componente de Tendência
